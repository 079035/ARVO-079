Vulnerability: Truncated Message Handling

Summary of the fix: Ensure that the inner fields of a message are only accessed if the message has passed the length validation check.

Detailed description of the fix: The code in the diff file is a patch for a vulnerability related to handling truncated messages. The function `ccr_handle_message_from_client` is the entry point for handling messages from the client. In this function, there is a check to validate the length of the message using the macro `MSG_LEN_VALID`. However, after this check, there are several cases where the inner fields of the message are accessed without further validation, assuming that `MSG_LEN_VALID` already guarantees the correctness of the message.

The fix modifies the code to ensure that the inner fields of the message are only accessed if the message has passed the length validation check. This is done by introducing additional checks for each message type, utilizing the `MSG_LEN_VALID` macro. If the length of the message is not valid, an error is returned to the client.

Overall, the fix ensures that the code handles truncated messages correctly by validating the length of the message and only accessing the inner fields if the length is valid. This prevents potential crashes and incorrect behavior caused by accessing invalid data.